---
redirect_from:
  - "/notebooks/small/windows/07-discovery/sd-190518224039"
interact_link: content/notebooks/small/windows/07_discovery/SD-190518224039.ipynb
kernel_name: 
kernel_path: content/notebooks/small/windows/07_discovery
has_widgets: false
title: |-
  Empire Find Local Admin Access
pagenum: 63
prev_page:
  url: /notebooks/small/windows/07_discovery/SD-190518230446.html
next_page:
  url: /notebooks/small/windows/07_discovery/SD-190319021158.html
suffix: .ipynb
search: false powerview empire powershell situationalawareness network findlocaladminaccess specifies search local mordor com vwthy computers dataset domain agent access shire simulation description current user name module true specific server ldap run tasked id windows github blob master administrator localadminaccess subtree default wildcards accepted switch objects query admin metadata sd author roberto rodriguez cybrwardg creation date platform environment type c tool script empireproject lib modules py raw githubusercontent hunters forge datasets small discovery empirefindlocaladmin tar gz represents adversaries using openscmanagerw winapi establish handle remote host verify context acess target adversary view usemodule info needsadmin opsecsafe language minlanguageversion background outputextension none authors harmjy

comment: "***PROGRAMMATICALLY GENERATED, DO NOT EDIT. SEE ORIGINAL FILES IN /content***"
---

    <main class="jupyter-page">
    <div id="page-info"><div id="page-title">Empire Find Local Admin Access</div>
</div>
    <div class="jb_cell">

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Metadata">Metadata<a class="anchor-link" href="#Metadata"> </a></h2>
</div>
</div>
</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<table>
<thead><tr>
<th style="text-align:left"></th>
<th style="text-align:left"></th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">id</td>
<td style="text-align:left">SD-190518224039</td>
</tr>
<tr>
<td style="text-align:left">author</td>
<td style="text-align:left">Roberto Rodriguez @Cyb3rWard0g</td>
</tr>
<tr>
<td style="text-align:left">creation date</td>
<td style="text-align:left">2019/05/18</td>
</tr>
<tr>
<td style="text-align:left">platform</td>
<td style="text-align:left">Windows</td>
</tr>
<tr>
<td style="text-align:left">Mordor Environment</td>
<td style="text-align:left">shire</td>
</tr>
<tr>
<td style="text-align:left">Simulation Type</td>
<td style="text-align:left">C2</td>
</tr>
<tr>
<td style="text-align:left">Simulation Tool</td>
<td style="text-align:left">Empire</td>
</tr>
<tr>
<td style="text-align:left">Simulation Script</td>
<td style="text-align:left"><a href="https://github.com/EmpireProject/Empire/blob/master/lib/modules/powershell/situational_awareness/network/powerview/find_localadmin_access.py">https://github.com/EmpireProject/Empire/blob/master/lib/modules/powershell/situational_awareness/network/powerview/find_localadmin_access.py</a></td>
</tr>
<tr>
<td style="text-align:left">Mordor Dataset</td>
<td style="text-align:left"><a href="https://raw.githubusercontent.com/hunters-forge/mordor/master/datasets/small/windows/discovery/empire_find_local_admin.tar.gz">https://raw.githubusercontent.com/hunters-forge/mordor/master/datasets/small/windows/discovery/empire_find_local_admin.tar.gz</a></td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Dataset-Description">Dataset Description<a class="anchor-link" href="#Dataset-Description"> </a></h2><p>This dataset represents adversaries using the OpenSCManagerW Win32API call to establish a handle to the remote host and verify if the current user context has local administrator acess to the target.</p>

</div>
</div>
</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Adversary-View">Adversary View<a class="anchor-link" href="#Adversary-View"> </a></h2>
<pre><code>(Empire: V6W3TH8Y) &gt; usemodule situational_awareness/network/powerview/find_localadmin_access
(Empire: powershell/situational_awareness/network/powerview/find_localadmin_access) &gt; info

              Name: Find-LocalAdminAccess
            Module: powershell/situational_awareness/network/powerview/find_localadmin_access
        NeedsAdmin: False
        OpsecSafe: True
          Language: powershell
MinLanguageVersion: 2
        Background: True
  OutputExtension: None

Authors:
  @harmj0y

Description:
  Finds machines on the local domain where the current user
  has local administrator access. Part of PowerView.

Comments:
  https://github.com/PowerShellMafia/PowerSploit/blob/dev/Reco
  n/

Options:

  Name                    Required    Value                     Description
  ----                    --------    -------                   -----------
  ComputerName            False                                 Hosts to enumerate, comma separated.    
  SearchScope             False                                 Specifies the scope to search under,    
                                                                Base/OneLevel/Subtree (default of       
                                                                Subtree)                                
  ComputerSiteName        False                                 Search computers in the specific AD site
                                                                name, wildcards accepted.               
  Server                  False                                 Specifies an active directory server    
                                                                (domain controller) to bind to          
  Tombstone               False                                 Switch. Specifies that the search should
                                                                also return deleted/tombstoned objects. 
  ComputerOperatingSystem False                                 Searches computers with a specific      
                                                                operating system. Wildcards accepted.   
  ResultPageSize          False                                 Specifies the PageSize to set for the   
                                                                LDAP searcher object.                   
  ComputerDomain          False                                 Specifies the domain to query for       
                                                                computers, defaults to the current      
                                                                domain.                                 
  ComputerSearchBase      False                                 Specifies the LDAP source to search     
                                                                through for computers                   
  ServerTimeLimit         False                                 Specifies the maximum amount of time the
                                                                server spends searching. Default of 120 
                                                                seconds.                                
  ComputerServicePack     False                                 Search computers with a specific service
                                                                pack                                    
  Agent                   True        V6W3TH8Y                  Agent to run module on.                 
  CheckShareAccess        False                                 Switch. Only display found shares that  
                                                                the local user has access to.           
  ComputerLDAPFilter      False                                 Specifies an LDAP query string that is  
                                                                used to search for computer objects.    

(Empire: powershell/situational_awareness/network/powerview/find_localadmin_access) &gt; execute
[*] Tasked V6W3TH8Y to run TASK_CMD_JOB
[*] Agent V6W3TH8Y tasked with task ID 11
[*] Tasked agent V6W3TH8Y to run module powershell/situational_awareness/network/powerview/find_localadmin_access
(Empire: powershell/situational_awareness/network/powerview/find_localadmin_access) &gt; Job started: X3U8SY
HFDC01.shire.com
IT001.shire.com

Find-LocalAdminAccess completed!

(Empire: powershell/situational_awareness/network/powerview/find_localadmin_access) &gt;</code></pre>

</div>
</div>
</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Explore-Mordor-Dataset">Explore Mordor Dataset<a class="anchor-link" href="#Explore-Mordor-Dataset"> </a></h2>
</div>
</div>
</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Initialize-Analytics-Engine">Initialize Analytics Engine<a class="anchor-link" href="#Initialize-Analytics-Engine"> </a></h3>
</div>
</div>
</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">from</span> <span class="nn">openhunt.mordorutils</span> <span class="kn">import</span> <span class="o">*</span>
<span class="n">spark</span> <span class="o">=</span> <span class="n">get_spark</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Download-&amp;-Process-Mordor-File">Download &amp; Process Mordor File<a class="anchor-link" href="#Download-&amp;-Process-Mordor-File"> </a></h3>
</div>
</div>
</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">mordor_file</span> <span class="o">=</span> <span class="s2">&quot;https://raw.githubusercontent.com/hunters-forge/mordor/master/datasets/small/windows/discovery/empire_find_local_admin.tar.gz&quot;</span>
<span class="n">registerMordorSQLTable</span><span class="p">(</span><span class="n">spark</span><span class="p">,</span> <span class="n">mordor_file</span><span class="p">,</span> <span class="s2">&quot;mordorTable&quot;</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Get-to-know-your-data">Get to know your data<a class="anchor-link" href="#Get-to-know-your-data"> </a></h3>
</div>
</div>
</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">df</span> <span class="o">=</span> <span class="n">spark</span><span class="o">.</span><span class="n">sql</span><span class="p">(</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">SELECT channel, COUNT(1)</span>
<span class="sd">FROM mordorTable</span>
<span class="sd">GROUP BY channel</span>
<span class="sd">    &#39;&#39;&#39;</span>
<span class="p">)</span>
<span class="n">df</span><span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="kc">False</span><span class="p">)</span>
        
</pre></div>

    </div>
</div>
</div>

</div>
</div>

 


    </main>
    